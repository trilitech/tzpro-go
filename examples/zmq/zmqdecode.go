package main

import (
	// "blockwatch.cc/tzpro-go/tzpro"
	"blockwatch.cc/tzpro-go/tzpro/zmq"
	// "context"
	"encoding/json"
	"fmt"
)

// Edo2 example!!
const o1 = `[617747,1614746963000,54227,26,"onhMEQfYWnq7mnygY7sYr6vwhFtzxgnfzx955Tqomm9R8rfY9u1",21302,10,0,0,3,0,"transaction","applied",1,1,21148,21048,0.656,20,1820,0,0.000000,0.013812,0.000000,0.000000,0.000000,22757,33692,0,0,0,1,"update","01ff06757064617465000006b302000006ae070401000000084241542d5553444307070100000063737073696731596b7574653367526e6a37625242504e56546a5135395a523638713957774478453554616f41487646686137717a4b75736f436554344e4259445a5646776e475475776b4b5762586e4e3431463256385a574a6a3738316750363938430707008cd1f8830c07070088d2f8830c070700a3b45307070080ce53070700acb253070700b5be530080d4ae82ff01070401000000074254432d5553440707010000006373707369673159696d744767686a784b4c414d634e44514672706874506f594e35535470596a7465525650624e6b426a7a736f36444333666371747951536a6631746d3353766a4c5131333438616b686d5a4e4d7a5a6b5248414458684b42425557760707008cd1f8830c07070088d2f8830c070700b080eed4ee02070700b080eed4ee0207070090cec6b6ee02070700a0c1a2b9ee0200b784d60507040100000008434f4d502d555344070701000000637370736967314d58477a67526d695468774e6a334d537053505767795064647151724e4d4a747748546f63594266324c477672317039424d31437936426b7a6d72556a346646617974734e456e63716f457933705a79507352396547796f32674333420707008cd1f8830c07070088d2f8830c0707008091e3df03070700b0d6ebdf030707008088e9de03070700a0c0ebde030088f2eb02070401000000084441492d5553444307070100000063737073696731425058334265566a463250625448424e7932744377584d4659417774505659594d7366346575313566636668533944386e716b6e394e63705839314168506a476b5076455a78674173713154714a54485042534e50416132354d5654580707008cd1f8830c07070088d2f8830c070700989b7a070700989b7a070700989b7a070700989b7a009289e88001070401000000074554482d5553440707010000006373707369673145794e6e7a33775264394369426f425561317277733256626f4445746b4244396445447932766a6d753437777037506a4542316e6f466537597054505a6a595131506a6f5a3431446138534d5478685378516a636a51746458675648770707008cd1f8830c07070088d2f8830c070700b080f0c10b070700b080f0c10b070700a0ba85bf0b070700a0ba85bf0b00bbbcab57070401000000074b4e432d555344070701000000637370736967315378353977573163764a337357454d595458564b6f6d6f45397055363277565672663641334156655152687131486d36784779713854565a4871414b764666594d6367667a445a506d3632694c484a72314a75415572796b6a6b5253620707008cd1f8830c07070088d2f8830c07070094e4d701070700b4f0d70107070088bad70107070088bad7010080e0f68916070401000000084c494e4b2d55534407070100000063737073696731505638794c57754541544b756845753978326b726247327a784d7046637941344b4e32463274396e34326837764c616467437368487636664d454c354874733969654a345870434242504664374544366161396e4c744d6d6a564e6d4b0707008cd1f8830c07070088d2f8830c070700b4da991c07070080e99a1c0707009e8e971c07070082d8981c0090b2c5d002070401000000075245502d5553440707010000006373707369673143524462476353324e71354e4668456150365a4534626b386f6a53625172545a6e50563455545241745a457a53416f7264625331513542417451635a787442466244313874534864577670534d57733756774c4561646d3751683373780707008cd1f8830c07070088d2f8830c070700b0a88b1e070700b0a88b1e070700b082ee1d070700b082ee1d00b68fb0db010704010000000758545a2d55534407070100000063737073696731566b7a6266706e376e64617a32354565684a6e6b6b5236455437516761354d656f4e43776777525173634e317a4162556764447259537a5566743679796150706637784a69346e424d584a58705853654a6552453947387174385532360707008cd1f8830c07070088d2f8830c070700acc9dd030707008ca1de0307070080c5dd03070700a083de030080b3dca005070401000000075a52582d55534407070100000063737073696731416741544142444a4b32474a39786b7074743551454770426f4850716168617035596b66315533627267635357386a7a73444865586b71776f64786658796d4e76595244713951463773427667643353545a714c4853724c33754661320707008cd1f8830c07070088d2f8830c070700b8d6a701070700b8d6a701070700b8d6a701070700b8d6a70100a4eba6d402","070700851805090a0000002201034170a2083dccbc2be253885a8d0e9f7ce859eb370d0c5cae3b6994af4cb9d666","00000605000765076501000000084241542d555344430a000000202a3cb9aca52d41677c8916d8ef04e67d4d3868a59bf48754250fdadc64e626ab0200000023008cd1f8830c0088d2f8830c00a3b4530080ce5300acb25300b5be530080d4ae82ff0100000605000765076501000000074254432d5553440a000000205b9ecff432b137c2434d18cc263337513220e20a45073b9e5ced6546b9fed795020000002d008cd1f8830c0088d2f8830c00b080eed4ee0200b080eed4ee020090cec6b6ee0200a0c1a2b9ee0200b784d6050000060500076507650100000008434f4d502d5553440a000000201ea2111c2b13fcd7a66cd1c85ea6ebce03412b87fea1b47ee490366f44d8f6110200000029008cd1f8830c0088d2f8830c008091e3df0300b0d6ebdf03008088e9de0300a0c0ebde030088f2eb0200000605000765076501000000084441492d555344430a00000020b1a201334aa06931b8016394b2baf74ecf788b81eec51fdde5993f343390219c0200000022008cd1f8830c0088d2f8830c00989b7a00989b7a00989b7a00989b7a009289e8800100000605000765076501000000074554482d5553440a00000020d68d438437946ef36f4d140641dd6218178e53c37022e57946051fcb8977a1c10200000029008cd1f8830c0088d2f8830c00b080f0c10b00b080f0c10b00a0ba85bf0b00a0ba85bf0b00bbbcab5700000605000765076501000000074b4e432d5553440a0000002014ac11c9a31033ed7ff4372a383a16f42134c09333c93cce6b71710984c0415f0200000026008cd1f8830c0088d2f8830c0094e4d70100b4f0d7010088bad7010088bad7010080e0f6891600000605000765076501000000084c494e4b2d5553440a000000206f9a257879da14166ee5b751be4c5cc8e6823e90751e557e430bbb9b840015970200000026008cd1f8830c0088d2f8830c00b4da991c0080e99a1c009e8e971c0082d8981c0090b2c5d00200000605000765076501000000075245502d5553440a0000002047df92a0fe20fb04fe2d62b0894ff4abbc33a27b879872c9163535802d9520e60200000026008cd1f8830c0088d2f8830c00b0a88b1e00b0a88b1e00b082ee1d00b082ee1d00b68fb0db01000006050007650765010000000758545a2d5553440a00000020a332fdddb0aaf8351a8d22008342aa6fadf5cd81941d10a01e7ba7a362a4729c0200000026008cd1f8830c0088d2f8830c00acc9dd03008ca1de030080c5dd0300a083de030080b3dca00500000605000765076501000000075a52582d5553440a000000209b7f80aeb2a6f401ede5bbb7cbedecc45019751cdcc1e12a40b6042a4b4cdadb0200000026008cd1f8830c0088d2f8830c00b8d6a70100b8d6a70100b8d6a70100b8d6a70100a4eba6d402",null,0.000000,54173,54172,55,0,2,0,"tz1cKN5tR1CvfsCN2nFpzvmPdJi9z8NLMU9W","KT1D2F12dbneCAJUXDxzYgoZu8gb5Mjf618m",null,null,1,0,"BKkYGtvwj6fmGnKoS57Gd7vz5ggXoeVPBuhPCFbQSRWd1RiFsBU"]`

func main() {
	if err := run(); err != nil {
		fmt.Println("ERRO", err)
	}
}

func run() error {
	// ctx, cancel := context.WithCancel(context.Background())
	// defer cancel()
	// client := tzpro.NewClient("https://api.tzpro.io", nil)

	msg := o1

	m := zmq.NewMessage([]byte("raw_op"), []byte(msg))
	op, err := m.DecodeOp()
	if err != nil {
		return err
	}

	// to decode contract data
	// client.Op.ResolveTypes(ctx, op)
	// op.DecodeParams()
	// op.DecodeStorage()
	// op.DecodeBigmapUpdates()

	buf, _ := json.MarshalIndent(op, "", "  ")
	fmt.Println(string(buf))
	return nil
}
